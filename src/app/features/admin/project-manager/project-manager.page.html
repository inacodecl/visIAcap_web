<ion-header class="ion-no-border header-inacap">
    <div class="top-section">
        <div class="header-content">
            <ion-buttons slot="start" class="menu-btn-container">
                <ion-back-button defaultHref="/admin/dashboard" color="light"></ion-back-button>
            </ion-buttons>

            <div class="logo-container">
                <img src="assets/icon/logo-inacap-60-v2.png" alt="Logo Inacap" class="logo-placeholder">
            </div>

            <div class="header-text">
                <span class="sede-text">SEDE<br>RENCA (ADMIN)</span>
            </div>
        </div>
    </div>
</ion-header>

<ion-content [fullscreen]="true" [scrollY]="true" class="admin-content">
    <div class="glass-container">

        <!-- HEADER ROW: Título + Buscador -->
        <div class="page-header-row">
            <h1 class="page-title">
                <ion-icon name="rocket"></ion-icon>
                Gestión de Proyectos
            </h1>
            <div class="search-wrapper">
                <ion-searchbar placeholder="Buscar proyectos..." [debounce]="250"
                    (ionInput)="searchTerm.set($any($event).target.value)" animated="true" class="neon-searchbar">
                </ion-searchbar>
            </div>
        </div>

        <!-- ACTION CARDS -->
        <ion-grid class="action-cards-grid ion-margin-bottom">
            <ion-row>
                <!-- NEW PROJECT CARD (Large) -->
                <ion-col size="12" size-md="6">
                    <div class="quick-card main-action" (click)="openCreateModal()">
                        <div class="icon-bg"><ion-icon name="add"></ion-icon></div>
                        <div class="content">
                            <h3>Crear Nuevo Proyecto</h3>
                            <p>Iniciar el asistente de creación</p>
                        </div>
                        <ion-icon name="arrow-forward" class="arrow-icon"></ion-icon>
                    </div>
                </ion-col>

                <!-- METADATA CARDS (Small) -->
                <ion-col size="6" size-md="3">
                    <div class="quick-card meta-action" (click)="openTagsManager()">
                        <div class="icon-circle"><ion-icon name="pricetags"></ion-icon></div>
                        <span>Crear Tag</span>
                    </div>
                </ion-col>
                <ion-col size="6" size-md="3">
                    <div class="quick-card meta-action" (click)="openCategoriesManager()">
                        <div class="icon-circle"><ion-icon name="list"></ion-icon></div>
                        <span>Crear Categoría</span>
                    </div>
                </ion-col>
            </ion-row>
        </ion-grid>

        <!-- TYPE FILTER (Local Segment) -->
        <div class="filter-container">
            <ion-segment [value]="filterType()" (ionChange)="segmentChanged($event)" class="neon-segment">
                <ion-segment-button value="presente">
                    <ion-label>SEDE (PRESENTE)</ion-label>
                </ion-segment-button>
                <ion-segment-button value="futuro">
                    <ion-label>INNOVACIÓN (FUTURO)</ion-label>
                </ion-segment-button>
            </ion-segment>
        </div>

        <div class="status-summary">
            <p>Mostrando <span class="highlight">{{ filteredProyectos().length }}</span> proyectos</p>
        </div>

        <!-- LIST GRID -->
        <ion-grid>
            <ion-row>
                <ion-col size="12" size-md="6" size-xl="4" *ngFor="let p of filteredProyectos()">
                    <ion-card class="glass-card" [class.unpublished-item]="!p.is_published">
                        <div class="card-glow"></div>
                        <ion-card-header>
                            <div class="header-row">
                                <div class="slug-badge">{{ p.slug }}</div>
                                <ion-badge [color]="p.is_published ? 'success' : 'medium'" class="status-badge">
                                    {{ p.is_published ? 'PUBLICADO' : 'BORRADOR' }}
                                </ion-badge>
                            </div>
                            <ion-card-title>{{ p.titulo }}</ion-card-title>
                        </ion-card-header>
                        <ion-card-content>
                            <p class="description">{{ p.resumen || 'Sin resumen...' }}</p>
                            <div class="location-badge" *ngIf="p.location">
                                <ion-icon name="globe"></ion-icon> {{ p.location }}
                            </div>

                            <div class="actions-panel">
                                <div class="buttons">
                                    <ion-button fill="clear" color="secondary" (click)="openEditModal(p)"
                                        class="action-btn edit-btn">
                                        <ion-icon slot="icon-only" name="create"></ion-icon>
                                    </ion-button>
                                    <ion-button fill="clear" color="danger" (click)="deleteProyecto(p.id)"
                                        class="action-btn delete-btn">
                                        <ion-icon slot="icon-only" name="trash"></ion-icon>
                                    </ion-button>
                                </div>
                            </div>
                        </ion-card-content>
                    </ion-card>
                </ion-col>
            </ion-row>
        </ion-grid>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredProyectos().length === 0">
            <div class="hologram-circle"></div>
            <p>No hay proyectos en esta categoría.</p>
        </div>

    </div>
</ion-content>