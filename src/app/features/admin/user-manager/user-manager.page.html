<ion-header [translucent]="true" class="admin-header">
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>
        <ion-title>Gestión de Usuarios (Super Admin)</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [scrollY]="true" class="admin-content">
    <div class="container">

        <div class="section-header">
            <h2>Directorio de Cuentas</h2>
            <p>Administra accesos y roles del sistema.</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="ion-text-center ion-padding">
            <ion-spinner></ion-spinner>
        </div>

        <!-- Lista de Usuarios -->
        <ion-list *ngIf="!isLoading" class="user-list">
            <ion-item-group *ngFor="let user of users">
                <ion-item lines="full" class="user-item">
                    <ion-icon slot="start" name="person" class="avatar-icon"></ion-icon>
                    <ion-label>
                        <h2>{{ user.nombre }} {{ user.apellido }}</h2>
                        <p>{{ user.email }}</p>
                    </ion-label>

                    <div slot="end" class="item-actions">
                        <ion-badge color="tertiary" class="role-badge">{{ user.rol }}</ion-badge>
                        <ion-toggle [checked]="user.is_active"
                            (ionChange)="toggleUserStatus(user, $event)"></ion-toggle>
                    </div>
                </ion-item>
            </ion-item-group>
        </ion-list>

        <!-- FAB para Crear -->
        <ion-fab vertical="bottom" horizontal="end" slot="fixed">
            <ion-fab-button color="tertiary" (click)="openCreateModal()">
                <ion-icon name="add"></ion-icon>
            </ion-fab-button>
        </ion-fab>

        <!-- Modal Formulario -->
        <ion-modal [isOpen]="isModalOpen" (didDismiss)="closeModal()">
            <ng-template>
                <ion-header>
                    <ion-toolbar>
                        <ion-title>Nuevo Usuario</ion-title>
                        <ion-buttons slot="end">
                            <ion-button (click)="closeModal()">
                                <ion-icon name="close"></ion-icon>
                            </ion-button>
                        </ion-buttons>
                    </ion-toolbar>
                </ion-header>
                <ion-content class="ion-padding">
                    <form [formGroup]="userForm" (ngSubmit)="createUser()">

                        <ion-item class="form-item">
                            <ion-label position="stacked">Nombre</ion-label>
                            <ion-input formControlName="nombre"></ion-input>
                        </ion-item>

                        <ion-item class="form-item">
                            <ion-label position="stacked">Apellido</ion-label>
                            <ion-input formControlName="apellido"></ion-input>
                        </ion-item>

                        <ion-item class="form-item">
                            <ion-label position="stacked">Email</ion-label>
                            <ion-input type="email" formControlName="email"></ion-input>
                        </ion-item>

                        <ion-item class="form-item">
                            <ion-label position="stacked">Contraseña</ion-label>
                            <ion-input type="password" formControlName="password"></ion-input>
                        </ion-item>

                        <ion-item class="form-item">
                            <ion-label position="stacked">Rol</ion-label>
                            <ion-select formControlName="rol">
                                <ion-select-option value="super_admin">Super Admin</ion-select-option>
                                <ion-select-option value="admin">Admin</ion-select-option>
                                <ion-select-option value="editor">Editor</ion-select-option>
                                <ion-select-option value="viewer">Viewer</ion-select-option>
                            </ion-select>
                        </ion-item>

                        <div class="modal-actions ion-margin-top">
                            <ion-button expand="block" type="submit" [disabled]="userForm.invalid || isLoading">
                                {{ isLoading ? 'Creando...' : 'Crear Usuario' }}
                            </ion-button>
                        </div>

                    </form>
                </ion-content>
            </ng-template>
        </ion-modal>

    </div>
    <!-- Spacer for FAB visibility -->
    <div class="fab-spacer"></div>
</ion-content>